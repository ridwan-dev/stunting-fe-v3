import{apopoverTrigger}from"../../../services/api.js";const AdminKeywords={render:async()=>'\n    <div class="app-content-padding flex-grow-1 overflow-auto admin-cover" data-height="100%">\n      <h2 class="page-header text-blue">\n        <i class="material-icons text-blue-600 align-middle me-1 mb-1">check_circle3</i>Administrasi Penandaan Intervensi\n      </h2>\n      \n      <form class=" " id="formsub">          \n        <div class="row pt-3 mx-0 mb-3 py-3 bg-gray-300 rounded" >        \n        <div class="col-xl-3">          \n        </div>\n        <div class="col-xl-4">          \n        </div>\n        <div class="col-xl-3 ">          \n          <div class="form-group sel_tax">                  \n            <select id="sel_tahun" name="sel_tahun" class="form-control" required>\n              <option value="">Pilih Tahun</option>\n              <option value="2022">2022</option>\n              <option value="2023">2023</option>\n              <option value="2024">2024</option>\n            </select>\n          </div>\n        </div>\n        <div class="col-xl-2 ">\n          <div class="form-group pull-right width-full">\n            <div class="btn btn-primary mx-3 px-3" id="subdata">Filter</div>\n          </div>\n        </div>\n        </div>          \n      </form>\n      \n      <form class="hide" id="input-revisi-penandaan">\t\n              \n        <div class="row mt-3" >\t\n          <div class="col-xl-12 ">\n            <div class="card">\n              <div class="card-body">\n                <div class="" id="table-admin-penandaan-pagu"></div>      \n              </div>      \n            </div>      \n          </div>      \n        </div>\n        <div class="row mt-3" >\t\n          <div class="col-xl-3">\n            <div class="form-group  width-full">\n            \x3c!--\n              <div class="btn btn-primary" data-click="swal-success" id="pushdata">Submit Data</div>\n            \n              <button type="submit" class="btn btn-primary" data-click="swal-success" id="pushdata">Submit Data</button>\n            --\x3e\n              </div>\n          </div>\n        </div>  \n            \n      </form> \n      <form id="datax"> \n      </form> \n\n      <div class="modal fade" id="tileModal" tabindex="-1" aria-hidden="true">\n        <div class="modal-dialog ">\n          <div class="modal-content" style="width: 58em;margin-left: -13em;">  \n            <div class="modal-header bg-gray-300">\n              <h4 class="modal-title" id="titleInv"></h4>\n              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>\n            </div>\n            <div class="modal-body" id="viewData">\n            </div>\t\t\t\n          </div>\n        </div>\n      </div>\n    </div>',after_render:async()=>{async function ListKeywords(tahun){try{let res=await fetch(config.api_url+"/renja/listrokeyword",{method:"POST",body:JSON.stringify({tahun:tahun}),headers:config.fetchHeaders}),_res;return(await res.json()).data}catch(e){return!1}}let form=document.querySelector("#formsub"),triggerButton;async function tableDataRo(tableData){const data=tableData.data,dataInt=()=>{let datax=Object.values(data);return data.sort((a,b)=>a.kementerian_kode>b.kementerian_kode?1:-1),data.forEach((item,i)=>{item.idx=i+1}),datax};console.log(tableData);const table=new Tabulator("#table-admin-penandaan-pagu",{height:"515px",index:"idx",data:dataInt(),layout:"fitDataStretch",columnHeaderVertAlign:"middle",dataLoader:!1,selectable:!0,columns:[{title:"No.",titleDownload:"No.",vertAlign:"middle",field:"idx",width:50,headerSort:!1,visible:!0,sorter:"number",hozAlign:"center",headerHozAlign:"center",frozen:!0},{title:"Kementerian/Lembaga",field:"kementerian_nama",width:200,variableHeight:!0,headerFilter:"input",formatter:function(cell,formatterParams){return"<div class='d-flex flex-row bd-highlight'> <div class='bd-highlight pe-1'></div><div class='bd-highlight text-wrap'>"+cell.getValue()+"</div></div>"}},{title:"Rincian Output",field:"suboutput_nama",width:350,variableHeight:!0,headerFilter:"input",formatter:function(cell,formatterParams){let value=cell.getValue(),ncode;return void 0!==cell._cell.row.data.ro_id?ncode='<div class="badge '+c_main+'"><span class="badge-left '+c_kl+' p-1" >'+cell._cell.row.data.kl_id+'</span><span class="'+c_prog+' p-1">'+cell._cell.row.data.program_id+'</span><span class="'+c_keg+' p-1">'+cell._cell.row.data.kegiatan_id+'</span><span class="'+c_kro+' p-1">'+cell._cell.row.data.kro_id+'</span><span class="'+color_ro+' badge-right p-1">'+cell._cell.row.data.ro_id+"</span></div>":void 0!==cell._cell.row.data.kementerian_kode?ncode='<div class="badge  '+c_main+'" ><span class="badge-main '+c_kl+' p-1">'+cell._cell.row.data.kl_id+"</span></div>":void 0!==cell._cell.row.data.kro_id?ncode='<div class="badge '+c_main+'" ><span class="badge-left '+c_kl+' p-1">'+cell._cell.row.data.kl_id+'</span><span class="'+c_prog+' p-1">'+cell._cell.row.data.program_id+'</span><span class="'+c_keg+' p-1">'+cell._cell.row.data.kegiatan_id+'</span><span class="'+c_kro+' badge-right p-1">'+cell._cell.row.data.kro_id+"</span></div>":void 0!==cell._cell.row.data.kegiatan_id?ncode='<div class="badge '+c_main+'"><span class="badge-left '+c_kl+' p-1">'+cell._cell.row.data.kl_id+'</span><span class="'+c_prog+' p-1">'+cell._cell.row.data.program_id+'</span><span class="'+c_keg+' badge-right p-1">'+cell._cell.row.data.kegiatan_id+"</span></div>":void 0!==cell._cell.row.data.program_id&&(ncode='<div class="badge '+c_main+'"><span class="badge-left '+c_kl+' p-1">'+cell._cell.row.data.kl_id+'</span><span class="'+c_prog+' badge-right p-1">'+cell._cell.row.data.program_id+"</span></div>"),ncode='<div class="badge '+c_main+'"><span class="badge-left '+c_kl+' p-1" title="K/L : '+cell._cell.row.data.kementerian_nama.trim()+'"  data-bs-toggle="popover" style="cursor:pointer" data-bs-trigger="hover" data-bs-title=" " data-bs-placement="top" data-bs-content="Renja K/L : Rp. 3.422.951.172.00"">'+cell._cell.row.data.kementerian_kode+'</span><span class="'+c_prog+' p-1" title="Program : '+cell._cell.row.data.program_nama.trim()+'">'+cell._cell.row.data.program_kode+'</span><span class="'+c_keg+' p-1" title="Kegiatan : '+cell._cell.row.data.kegiatan_nama.trim()+'">'+cell._cell.row.data.kegiatan_kode+'</span><span class="'+c_kro+' p-1" title="KRO : '+cell._cell.row.data.output_nama.trim()+'">'+cell._cell.row.data.output_kode+'</span><span class="'+color_ro+' badge-right p-1" title="RO : '+cell._cell.row.data.suboutput_nama.trim()+'">'+cell._cell.row.data.suboutput_kode+"</span></div>",`\n              <div class="d-flex flex-row bd-highlight">\n              <div class="bd-highlight">${ncode}</div>\n              <div class="bd-highlight text-wrap">${cell._cell.row.data.suboutput_nama}</div>\n              </div>\n              `}},{title:"Intervensi",field:"intervensi_nama",width:10,variableHeight:!0,headerFilter:"input",cellClick:function(e,cell){let popupIntv;if(console.log(cell._cell.row.data),$("#titleInv").html("Edit Intervensi RO "+cell._cell.row.data.suboutput_nama),null===cell._cell.row.data.tipe_nama)popupIntv=`\n              <div action="${window.location.href}" id="formIntv">\n\t\t\t\t\t\t\t\t<fieldset>\n                  <div class="mb-3">\n                    <input type="hidden" value="${cell._cell.row.data.idro}" name="ro_id" id="ro_id" required>\n                    <input type="hidden" value="${cell._cell.row.data.thang}" name="thang" id="thang" required>\n\t\t\t\t\t\t\t\t\t\t<label class="form-label" for="grInt">Group Intevensi</label>\n\t\t\t\t\t\t\t\t\t\t<select class="form-select" id="grIntMaster"  required>\n                      <option value="" >Pilih</option>\n                      <option value="1-Spesifik"  >Spesifik</option>\n                      <option value="2-Sensitif"  >Sensitif</option>\n                      <option value="3-Dukungan"  >Dukungan</option>\n                    </select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="mb-3 hide" id="intMaster">\n\t\t\t\t\t\t\t\t\t\t<label class="form-label" for="deskInt">Intervensi</label>\n\t\t\t\t\t\t\t\t\t\t<select class="form-select" id="selectIntMaster" required>\n                    </select>\n\t\t\t\t\t\t\t\t\t</div>\n                  <button type="submit" class="btn btn-primary w-100px me-5px" id="submitIntv">Submit</button>\n\t\t\t\t\t\t\t\t\t<div class="btn btn-default w-100px" data-bs-dismiss="modal">Cancel</div>\n\t\t\t\t\t\t\t\t</fieldset>\n\t\t\t\t\t\t\t</div>\n              `;else{let gIntv=cell._cell.row.data.tipe_nama,codeInt,optn=[];data_pertype["Spesifik"===gIntv?1:"Sensitif"===gIntv?2:3].forEach(a=>{optn.push(`\n                  <option value="${a.intervensi_kode}" ${cell._cell.row.data.intervensi_nama==a.intervensi_nama?"selected='selected'":""}>${a.intervensi_kode+"-"+a.intervensi_nama}</option>\n                  `)});let optionv=["<option value='' >Pilih</option>"].concat(optn);popupIntv=`\n              <div action="${window.location.href}" id="formIntv">\n\t\t\t\t\t\t\t\t<fieldset>\n                  <div class="mb-3">\n                    <input type="hidden" value="${cell._cell.row.data.idro}" name="ro_id" id="ro_id" required>\n                    <input type="hidden" value="${cell._cell.row.data.thang}" name="thang" id="thang" required>\n\t\t\t\t\t\t\t\t\t\t<label class="form-label" for="grInt">Group Intevensi</label>\n\t\t\t\t\t\t\t\t\t\t<select class="form-select" id="grIntMaster"  required>\n                      <option value="" >Pilih</option>\n                      <option value="1-Spesifik"  ${"Spesifik"==gIntv?"selected='selected'":""}>Spesifik</option>\n                      <option value="2-Sensitif"  ${"Sensitif"==gIntv?"selected='selected'":""}>Sensitif</option>\n                      <option value="3-Dukungan"  ${"Dukungan"==gIntv?"selected='selected'":""}>Dukungan</option>\n                    </select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="mb-3" id="intMaster">\n\t\t\t\t\t\t\t\t\t\t<label class="form-label" for="deskInt">Intervensi</label>\n\t\t\t\t\t\t\t\t\t\t<select class="form-select" id="selectIntMaster" required>\n                      ${optionv.join("")}\n                    </select>\n\t\t\t\t\t\t\t\t\t</div>\n                  <button type="submit" class="btn btn-primary w-100px me-5px" id="submitIntv">Submit</button>\n\t\t\t\t\t\t\t\t\t<div class="btn btn-default w-100px" data-bs-dismiss="modal">Cancel</div>\n\t\t\t\t\t\t\t\t</fieldset>\n\t\t\t\t\t\t\t</div>\n              `}$("#viewData").html(popupIntv),$("#grIntMaster").on("change",(function(){let grp=$(this).val(),grpSplit=grp.split("-"),opt=[];""===grp?$("#intMaster").addClass("hide"):$("#intMaster").removeClass("hide"),data_pertype[grpSplit[0]].forEach(a=>{opt.push(`\n                  <option value="${a.intervensi_kode}">${a.intervensi_kode+"-"+a.intervensi_nama}</option>\n                  `)});let optionv=["<option value='' >Pilih</option>"].concat(opt);$("#intMaster select").html(optionv.join(""))})),document.querySelector("#submitIntv").addEventListener("click",event=>{const form=document.querySelector("#formIntv");if(form){const fields=["ro_id","thang","grIntMaster","selectIntMaster"];validateonSubmitFormIntv(form,fields)}})},formatter:function(cell,formatterParams){let conten,btn;return"<div class='d-flex justify-content-between'> <div class='bd-highlight pe-1 name_intv' >"+(null===cell.getValue()?"belum ditentukan":"<div class='d-flex flex-row bd-highlight'> <div class='bd-highlight pe-1'>"+cell._cell.row.data.kode_intervensi+" - </div><div class='bd-highlight text-wrap'>"+cell.getValue()+"</div></div>")+"</div><div class='bd-highlight text-wrap'>"+"<div class='btn btn-primary my-1 py-1 px-2 fs-11px editRoIntv' data-bs-toggle='modal' data-bs-target='#tileModal' >Edit</div>"+"</div></div>"}}],initialSort:[{column:"idx",dir:"asc"}]});async function validateonSubmitFormIntv(form,fields){var error=0;if(fields.forEach(field=>{const input=document.querySelector(`#${field}`);0==validateFields(input)&&error++}),console.log("error",error),error>0)return!1;{let e=document.querySelector("#selectIntMaster"),dataX={kode_intervensi:e.value,id_ro:document.querySelector("#ro_id").value,tahun:document.querySelector("#thang").value};try{let res=await fetch(config.api_url+"/renja/rointervensi",{method:"POST",body:JSON.stringify(dataX),headers:config.fetchHeaders}),_res=await res.json();return $("#tileModal").modal("hide"),_res.status&&($(".tabulator-selected").find(".name_intv").html(e.options[e.selectedIndex].text),$(".tabulator-selected").removeClass("tabulator-selected"),swal({title:"Data tersimpan",text:" ",icon:"success",buttons:{confirm:{text:"Tutup",value:!0,visible:!0,className:"btn btn-success",closeModal:!0}}})),_res.data}catch(e){return!1}}}return table}document.querySelector("#subdata").onclick=async function(){let subdata;if($("#input-revisi-penandaan").removeClass("hide"),$("#table-admin-penandaan-pagu").parent().addClass("loading"),form.reportValidity()){let thn=$("#sel_tahun").val();await ListKeywords(thn).then((function(data){console.log("xx",data),tableDataRo(data),$("#table-admin-penandaan-pagu").parent().removeClass("loading")}))}},apopoverTrigger()}};export default AdminKeywords;