import{base_url}from"./../js/utility/api.js";const validateAuth=e=>{return null!=getWithExpiry("userLogIn")},logOut=()=>{localStorage.removeItem("auth"),localStorage.removeItem("userProfile"),localStorage.removeItem("userLogIn"),delete user.name,delete user.email,delete user.role,window.location.replace("#/login")},validateonSubmit=(e,r,o)=>{e.addEventListener("submit",e=>{e.preventDefault();var t=0;if(r.forEach(e=>{e=document.querySelector("#"+e);0==validateFields(e)&&t++}),""==o||null==o||0==o.length||0<t)return!1;e={email:document.querySelector("#email").value,password:document.querySelector("#password").value};fetch(config.api_url+"/auth/login",{method:"POST",body:JSON.stringify(e),headers:config.fetchHeaders}).then(function(e){return e.json()}).then(function(e){e.status?(setWithExpiry("auth",1,36e5),setWithExpiry("userLogIn",e.data.token,36e5),setWithExpiry("userProfile",e.data,36e5),window.location.replace("/"+base_url)):(console.log("Login failed"),document.querySelector(".alert").classList.remove("d-none"))}).catch(function(e){return!1})})},validateFields=e=>""===e.value.trim()?(setStatus(e,e.nextElementSibling.innerText+" tidak boleh kosong!","error"),!1):(setStatus(e,null,"success"),!0),setStatus=(e,t,r)=>{const o=e.parentElement.querySelector(".error-message");"success"==r&&(o&&(o.innerText=""),e.classList.remove("input-error")),"error"==r&&(o.innerText=t,e.classList.add("input-error"))};export{validateAuth,logOut,validateonSubmit};